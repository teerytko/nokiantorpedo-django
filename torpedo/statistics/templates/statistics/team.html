{% extends 'statistics/base.html' %}
{% block head_datatables %}
<script type="text/javascript" charset="utf-8">
var oTable
var sid = getQueryVariable("sId");
var editMode = false;
$(document).ready(function() {
    oTable = $('#players').dataTable( {
        "bProcessing": true,
        "bServerSide": true,
        "bPaginate": false,
        "bInfo": false,
        "bFilter": false,
        "sAjaxSource": "../statistics/rest/player?format=dlist&sQuery=team_id=="+sid,
        "aaSorting": [[2,'asc']],
        aoColumns: [{ "sName": "id", bVisible: false}, // the first column is invisible
                    { "bVisible": false , "sName": "team_id"},
                    { "sClass": "text", "sName": "number"},
                    { "sClass": "text", "sName": "name"},
                    { "sClass": "text", "sName": "role"},
                   ],
        "fnDrawCallback": function () {
            if (editMode == true) {
                $('td.text').create_edit({'oTable' : oTable, 
                                          'sUpdateUrl': '../statistics/rest/player'});
            }
        }
    });
    /* Add a click handler to the rows - this could be used as a callback */
    $("#players tbody").click(function(event) {
        $(oTable.fnSettings().aoData).each(function (){
            $(this.nTr).removeClass('row_selected');
        });
        $(event.target.parentNode).addClass('row_selected');
    });

    /* Add a click handler for the delete row */
    $('#delete').click( function() {
        var anSelected = fnGetSelected( oTable );
        var sId = oTable.fnGetData(oTable.fnGetPosition(anSelected[0]))[0]
        delete_datarow(oTable, 'player', sId);
    });
    /* Add a click handler for the delete row */
    $('#add').click( function() {
        add_datarow(oTable, 'player', {team: sid,
                                       number: 1,
                                       name: '',
                                       role: ''});
    });
    /* Add a click handler for the delete row */
    $('#edit').click( function() {
        if (editMode == false) {
            $('#edit').html('Lopeta muokkaus')
            editMode = true
            oTable.fnDraw();    
        }
        else {
            $('#edit').html('Muokkaa');
            editMode = false;
            oTable.fnDraw();    
        }
    });

    $.getJSON('../statistics/rest/team?format=dlist&sQuery=id=='+sid, function(data) {
        data = data['aaData'][0];
        $('#home-team-name').html(data[1]);
    }); 

});


</script>
{% endblock %} 

{% block center %}
<article id="fullmaincolumn">
<div id="datatables">
    <div id="container">
    <div class="full_width big">
        <i><div id="home-team-name"></div></i>
        </div>
    <div id="dynamic">
    <!-- joukkeen pelaajat -->
    <h2>Pelaajat</h2>
    <p>
        <a href="./teams">Takaisin joukkueisiin</a>
        {% if perms.statistics.change_game %}
        /
        <a href="javascript:void(0);" id="add">Lisää</a>
        /
        <a href="javascript:void(0)" id="delete">Poista</a>
        /
        <a href="javascript:void(0)" id="edit">Muokkaa</a>
        {% endif %}
    </p>
    <table cellpadding="0" cellspacing="0" border="0" class="display" id="players">
        <thead>
            <tr>
                <th width="10%">Id</th>
                <th width="15%">Team_id</th>
                <th width="20%">Number</th>
                <th width="50%">Name</th>
                <th width="50%">Rooli</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
                <td>null</td>
            </tr>
        </tbody>
    </table>
    </div>
</div>
</div>

</article>
{% endblock %}
